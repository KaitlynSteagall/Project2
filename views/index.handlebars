{{!-- Need to handlebar-ify it, but this will be the main page --}}
<nav class="navbar navbar-expand-lg navbar-light mb-3" style="background-color:rgba(255, 255, 255, 0.766)">
  <div class="container">

    <a class="navbar-brand" href="#">
      <h2 class="logo">Puffin Power</h2>
    </a>

    <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
      aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" data-toggle="modal" href="#loginPage">Researcher Login</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="modal" href="#donatePage">Donate</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="modal" href="#aboutUsPage">About Us</a>
        </li>
      </ul>
    </div>
    ​
  </div>
</nav>

<div class="container" style="background-color:rgba(255, 255, 255, 0.766)">
  <div class="row my-4">

    <form class="col-lg-5 col-xs-5 my-5">

      <h3>Help us Perform Research</h3>

      <div class="form-row mt-4 mb-3">
        <div class="col">
          <input type="text" class="form-control" placeholder="First name" required>
        </div>
        <div class="col">
          <input type="text" class="form-control" placeholder="Last name" required>
        </div>
      </div>

      <div class="custom-file mb-3">
        <input type="file" class="custom-file" id="validatedCustomFile">
        <label class="custom-file-label" for="validatedCustomFile">Choose File</label>
      </div>

      <div>
        <div class="input-group mb-2 ">
          <canvas id="canvas" style="background-color: white; border-radius: 5px 0 0 5px;">
            <!-- we put images here to manipulate them. this div carries display:none so the user never sees it -->
          </canvas>
          <div class="input-group-append">
            <div id="openCameraBtn" class="input-group-text" data-toggle="modal" href="#takePicturePage">
              <span><i class="fas fa-camera"></i></span>
            </div>
            <div id="deletePicBtn" class="input-group-text" data-toggle="modal">
              <span><i class="fas fa-trash-alt"></i></span>
            </div>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <textarea class="form-control" id="validationTextarea" style="height: 11rem;"
          placeholder="Tell us about your observation. Ex: Where did you see the puffin? What were it's surroundings? What was it doing? For how long?"
          required></textarea>
      </div>

      <button class="btn" type="submit" style="background-color: aquamarine;">Submit</button>

    </form>

    <div id="carouselExampleControls" class="col-lg-7 col-xs-7 carousel slide my-auto" data-ride="carousel">

      <div class="carousel-inner">

        <div class="carousel-item active">
          <img src="./images/alex-makarov-jnZ5fTnn0i8-unsplash.jpg" class="d-block w-100 mt-auto mb-3"
            alt="Puffins nuzzling">
        </div>

        <div class="carousel-item">
          <img src="./images/jonatan-pie-8oEuGJ-Uva0-unsplash.jpg" class="d-block w-100 mt-auto mb-3"
            alt="Puffins in grass">
        </div>

        <div class="carousel-item">
          <img src="./images/liudmila-shuvalova-ZHYXoJDrQ0M-unsplash.jpg" class="d-block w-100 mt-auto mb-3"
            alt="Puffin with fish">
        </div>

        <div class="carousel-item">
          <img src="./images/m-zonderling-COMlc1Z23N4-unsplash.jpg" class="d-block w-100 mt-auto mb-3"
            alt="Puffins on rocks">
        </div>

        <div class="carousel-item">
          <img src="./images/ray-hennessy-PHnBeYvpWgA-unsplash.jpg" class="d-block w-100 mt-auto mb-3"
            alt="Puffin flying">
        </div>

        <div class="carousel-item">
          <img src="./images/sarah-kilian-vf0lyNg41lk-unsplash.jpg" class="d-block w-100 mt-2 mb-3"
            alt="Puffins fighting">
        </div>

      </div>

      <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>

      <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>

    </div>

  </div>
</div>

<div class="modal fade" id="loginPage" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-centered" role="document">
    <div class="modal-content">

      <div class="modal-body">
        <form>

          <div class="form-group mt-2">
            <label for="username">Username</label>
            <input type="username" class="form-control" id="username" aria-describedby="usernameHelp"
              placeholder="Enter Username">
            <small id="usernameHelp" class="form-text text-muted">Enter your assigned work username.</small>
          </div>

          <div class="form-group">
            <label for="userPassword">Password</label>
            <input type="password" class="form-control" id="userPassword" placeholder="Password">
            <small id="emailHelp" class="form-text text-muted">
              Enter the password you created during orientation.
            </small>
          </div>

        </form>
      </div>
      <!-- <small class="ml-4 form-text text-muted">* = required</small> -->
      <button id="signinButton" type="button" class="btn align-right" data-dismiss="modal"
        style="background-color:aquamarine">Login</button>

    </div>
  </div>
</div>

<div class="modal fade" id="donatePage" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-centered" role="document">
    <div class="modal-content">

      <h5 class="modal-title mx-auto mt-3">***FUTURE GOAL***</h5>

      <div class="modal-body">
        <form>

          <div class="form-group">
            <label for="amount">Amount</label>
            <input type="amount" class="form-control" id="donationAmount" aria-describedby="amount" placeholder="$0.00">
            <small id="amountMessage" class="form-text text-muted">Enter the amount you'd like to donate.</small>
          </div>

          <div class="form-group">
            <label for="cardNumber">Card Number</label>
            <input type="cardNumber" class="form-control" id="cardNumber" aria-describedby="cardNumber"
              placeholder="Ex: 1234 5678 9876 5432">
            <small id="cardNumberMessage" class="form-text text-muted">Enter your 16 digit card number.</small>
          </div>

          <div class="form-group">
            <label for="expDate">Experation Date</label>
            <input type="expDate" class="form-control" id="expDate" aria-describedby="expDate" placeholder="Ex: 01/20">
            <small id="expDateMessage" class="form-text text-muted">Enter your experation date.</small>
          </div>

          <div class="form-group">
            <label for="CVV">CVV</label>
            <input type="CVV" class="form-control" id="CVV" aria-describedby="CVV" placeholder="Ex: 123">
            <small id="CVVmessage" class="form-text text-muted">
              Enter your CVV code. This can be found on the back of your card.
            </small>
          </div>

        </form>
      </div>

      <button id="donateButton" type="button" class="btn align-right" data-dismiss="modal"
        style="background-color:aquamarine">Donate</button>

    </div>
  </div>
</div>

<div class="modal fade" id="aboutUsPage" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-centered" role="document">
    <div class="modal-content">

      <h5 class="modal-title mx-auto mt-3">About our Organization</h5>

      <div class="modal-body">
        <p>
          We're a non-profit dedicated to the study and preservation of puffins.
          Their population is in a vunerable state and we want to keep these cute,
          spunky little clowns around as long as possible.
        </p>
        <p>
          The more information we have on these little guys the more we can help them, so
          we created this page to crowd-source info. If you see a puffin out in the wild,
          we'd love to see and hear about what you observed.
        </p>
      </div>

      <small class="text-muted mb-4" style="text-align: center; font-style: italic;">
        Thank you for your interest in puffins and their future pufflings.<br />
        We hope to hear from you soon!
      </small>

      <button type="button" class="btn align-right" data-dismiss="modal"
        style="background-color:aquamarine">Close</button>

    </div>
  </div>
</div>

<div class="modal fade" id="takePicturePage" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-centered" role="document">
    <div class="modal-content">

      <div class="modal-body mx-auto">
        {{!-- <!-- this div holds the video stream once we connect to the camera --> --}}
        <div class="camera">
          <video id="video">Video stream not available.</video>
        </div>
      </div>
      {{!-- <!-- this grabs the current frame from the stream when clicked --> --}}
      <button type="button" id="takePictureBtn" class="btn align-left" data-dismiss="modal"
        style="background-color:aquamarine">
        Take New Photo
      </button>
      <button type="button" id="takePictureBtn" class="btn align-right" data-dismiss="modal"
        style="background-color:aquamarine">
        Cancel
      </button>
    </div>
  </div>
</div>

<script type="text/javascript">
  // wrap in an anon function to control when it fires & keep variable overhead down
  (function () {
    const width = 300; // photo width locked to this. can be set to whatever we like
    let height = 0; // this one is variable, will be auto-computed from camera dimensions
    let streaming = false; // current state of stream
    let video; // after pageload, we define this as a ref to the <video> div
    let canvas; // after pageload, we define this as a ref to the <canvas> div
    let photo; // after pageload, reference to <img> div
    let cameraBtn; // after pageload, reference to camera button
    let validImage = false; // the API call can use this to check if there's an image present

    // function to open camera when button is clicked
    // we could make this jquery later for dryness if we wanted

    function openCamera() {
      console.log("inside open camera")
      video = document.getElementById('video');
      canvas = document.getElementById('canvas');
      photo = document.getElementById('photo');
      cameraBtn = document.getElementById('takePictureBtn');

      navigator.mediaDevices.getUserMedia({ audio: false, video: { facingMode: {"environment" }} })
        .then(stream => { // getusermedia returns the stream as a promise
          video.srcObject = stream; // set that stream as the source of video div
          video.play(); // also, begin stream playback
        })
        .catch(error => {
          console.log(`Stream error: ${error}`);
        })
      // video might take a second to start flowing, so put a listener on that event before we start messing with output
      video.addEventListener('canplay', event => {
        if (!streaming) {
          // get ratio of actual stream width to our preset width,
          // apply that ratio to incoming height
          height = video.videoHeight / (video.videoWidth / width);
          // safety check to set display to 4:3 if stream height can't be read
          if (isNaN(height)) {
            height = width / 1.33
          }
          // set video and canvas div sizes to match stream
          video.setAttribute('width', width)
            .setAttribute('height', height);
          canvas.setAttribute('width', width)
            .setAttribute('height', height);
          streaming = true;
        }
      }, false);

      // now that we're streaming, also start listening for attempts to take a picture
      cameraBtn.addEventListener('click', event => {
        event.preventDefault(); // PLEASE don't reload the page
        grabFrame(); // fire function to actually take photo
      }, false);

      // and finally call function to turn stream into PNG
      clearPhoto();
    }

    // function to replace "current photo" with empty square when photo is inactive
    function clearphoto() {
      const context = canvas.getContext('2d');
      // fill background with a light grey color
      context.fillStyle = "#AAA";
      context.fillRect(0, 0, canvas.width, canvas.height);
      // turn it into a PNG and put that PNG in the visible <img> div
      const newPNG = canvas.toDataURL('image/png');
      photo.setAttribute('src', newPNG);
      validImage = false;
    }

    // function to grab frame to begin with
    function grabFrame() {
      const context = canvas.getContext('2d');
      if (width && height) { // make sure there's actually something there
        canvas.width = width;
        canvas.height = height;
        context.drawImage(video, 0, 0, width, height);
        const newPNG = canvas.toDataURL('image/png');
        photo.setAttribute('src', newPNG);
        validImage = true;
      } else {
        clearphoto();
      }
    }

    // when we do our API call, we should be able to grab the SRC attribute of the "photo" div, IF there's anything there.
    // (well actually grab the url of the place that we push the image from its SRC attribute but that's a whole other thing)
    // (this is just the getusermedia bit)

    document.getElementById("openCameraBtn").addEventListener('click', event => {
      event.preventDefault(); // don't reload the page
      console.log("inside event listener")
      openCamera(); // create the camera
    }, false);
  })()

</script>

{{!-- EXAMPLE HANDLEBARS WE CAN REFER TO --}}

{{!-- <div id="home">
  <div class="container">
    <div class="row">
      <div class="col-8 offset-2">
        <h1>{{msg}}</h1>
        <h2>This is our Home Page!</h2>
        <form class="clearfix mb-4" action="POST">
          <div class="form-group">
            <label for="example-text">Example Text</label>
            <input type="text" id="example-text" class="form-control" aria-describedby="example-text" placeholder="Enter Example Text">
          </div>
          <div class="form-group">
            <label for="example-description">Example Description</label>
            <textarea class="form-control" id="example-description" aria-describedby="example-description" placeholder="Enter Example Description"></textarea>
          </div>
          <button id="submit" class="btn btn-primary float-right">Submit</button>
        </form>
        <h3>Examples:</h3>
        <ul id="example-list" class="list-group">
          {{#each examples}}
          <li data-id="{{this.id}}" class="list-group-item">
            <a href="example/{{this.id}}">{{this.text}}</a>
            <button class="btn btn-danger float-right delete">ｘ</button>
          </li>
          {{/each}}
        </ul>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="/js/index.js"></script> --}}