<!-- <!doctype html>
<html lang="en">

<head> -->
  <!-- meta tags -->
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <meta charset="utf-8">
</head>

<body> -->
  <button id="openCameraBtn">Click to Camera!</button>


  <div class="camera">
    <video id="video">Video stream not available.</video>
    <!-- this div holds the video stream once we connect to the camera -->
    <button id="takePictureBtn">Click to Capture!</button>
    <!-- this grabs the current frame from the stream when clicked -->
  </div>

  <canvas id="canvas">
    <!-- we put images here to manipulate them. this div carries display:none so the user never sees it -->
  </canvas>
  <div class="output">
    <img id="cameraDisplayDiv" alt="This image now available for upload.">
    <!-- this image div will be filled with our screencap once it's ready for the user to see -->
  </div>

  <!-- <script type="text/javascript">
    // wrap in an anon function to control when it fires & keep variable overhead down
    (function () {
      const width = 320; // photo width locked to this. can be set to whatever we like
      let height = 0; // this one is variable, will be auto-computed from camera dimensions
      let streaming = false; // current state of stream
      let video; // after pageload, we define this as a ref to the <video> div
      let canvas; // after pageload, we define this as a ref to the <canvas> div
      let photo; // after pageload, reference to <img> div
      let cameraBtn; // after pageload, reference to camera button
      let validImage = false; // the API call can use this to check if there's an image present

      // function to open camera when button is clicked
      // we could make this jquery later for dryness if we wanted

      function openCamera() {
        console.log("inside open camera")
        video = document.getElementById('video');
        canvas = document.getElementById('canvas');
        photo = document.getElementById('photo');
        cameraBtn = document.getElementById('takePictureBtn');

        navigator.mediaDevices.getUserMedia({ video: true, audio: false })
          .then(stream => { // getusermedia returns the stream as a promise
            video.srcObject = stream; // set that stream as the source of video div
            video.play(); // also, begin stream playback
          })
          .catch(error => {
            console.log(`Stream error: ${error}`);
          })
        // video might take a second to start flowing, so put a listener on that event before we start messing with output
        video.addEventListener('canplay', event => {
          if (!streaming) {
            // get ratio of actual stream width to our preset width,
            // apply that ratio to incoming height
            height = video.videoHeight / (video.videoWidth / width);
            // safety check to set display to 4:3 if stream height can't be read
            if (isNaN(height)) {
              height = width / 1.33
            }
            // set video and canvas div sizes to match stream
            video.setAttribute('width', width)
              .setAttribute('height', height);
            canvas.setAttribute('width', width)
              .setAttribute('height', height);
            streaming = true;
          }
        }, false);

        // now that we're streaming, also start listening for attempts to take a picture
        cameraBtn.addEventListener('click', event => {
          event.preventDefault(); // PLEASE don't reload the page
          grabFrame(); // fire function to actually take photo
        }, false);

        // and finally call function to turn stream into PNG
        clearPhoto();
      }

      // function to replace "current photo" with empty square when photo is inactive
      function clearphoto() {
        const context = canvas.getContext('2d');
        // fill background with a light grey color
        context.fillStyle = "#AAA";
        context.fillRect(0, 0, canvas.width, canvas.height);
        // turn it into a PNG and put that PNG in the visible <img> div
        const newPNG = canvas.toDataURL('image/png');
        photo.setAttribute('src', newPNG);
        validImage = false;
      }

      // function to grab frame to begin with
      function grabFrame() {
        const context = canvas.getContext('2d');
        if (width && height) { // make sure there's actually something there
          canvas.width = width;
          canvas.height = height;
          context.drawImage(video, 0, 0, width, height);
          const newPNG = canvas.toDataURL('image/png');
          photo.setAttribute('src', newPNG);
          validImage = true;
        } else {
          clearphoto();
        }
      }

      // when we do our API call, we should be able to grab the SRC attribute of the "photo" div, IF there's anything there.
      // (well actually grab the url of the place that we push the image from its SRC attribute but that's a whole other thing)
      // (this is just the getusermedia bit)

      document.getElementById("openCameraBtn").addEventListener('click', event => {
        event.preventDefault(); // don't reload the page
        console.log("inside event listener")
        openCamera(); // create the camera
      }, false);
    })()

  </script>

</body>

</html> -->